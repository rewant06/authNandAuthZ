generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AuditAction {
  AUTH_LOGIN_ATTEMPT
  AUTH_LOGIN_SUCCESS
  AUTH_LOGIN_FAILED
  AUTH_LOGIN_LOCKED
  PASSWORD_RESET_REQUEST
  PASSWORD_RESET_SUCCESS
  PASSWORD_RESET_FAILED
}

model User {
  id             String       @id @default(cuid())
  email          String       @unique
  name           String?
  hashedPassword String?
  auditEvents    AuditEvent[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

model AuditEvent {
  id      String      @id @default(cuid())
  userId  String?
  user    User?       @relation(fields: [userId], references: [id])
  email   String
  action  AuditAction
  success Boolean     @default(false)
  reason  String?
  ip      String?

  CreatedAt DateTime @default(now())

  @@index([action, CreatedAt])
  @@index([success, CreatedAt])
}
